## 用户强制下线

在ToughRADIUS中有一项很重要的功能，对在线用户强制下线。但在使用这一功能之前，管理员务必清楚的理解这一功能。在ToughRADIUS版本的更新迭代过程中，这一功能在不断完善。

首先必须了解，要正常使用强制下线功能，对接的NAS（路由器设备）必须支持并且必须在设备中开启相关选项，不同的设备配置方法可能不一样，你可以去咨询了的设备经销商和相关技术支持。

我们以RouterOS为例，开启这一功能有如下配置：

![][image-1]

你应该注意到了，端口3799与在ToughRADIUS对应的BAS设备配置是一致的，

配置设备的功能后，你还需要开放ToughRADIUS设备的管理端口，默认是1815，ToughRADIUS通过这一端口进行一些实时性更强的消息通讯，使用websocket实现，因此你必须保证这个端口和ToughRADIUS web管理的端口一样的访问权限。

这一端口是可以配置的，如果你修改了这一端口，或者使用了防火墙映射。另外也可以配置外部使用的地址。

![][image-2]


## 主动强制下线

在ToughRADIUS的在线用户查询界面中，可以对指定的在线用户直接解锁。在正常情况下，ToughRADIUS向NAS（路由器）设备发起强制下线请求，用户被断开，同时系统会生成上网记录。

## 被动强制下线

用户余额不足，过期等条件会自动触发用户强制下线请求，这一过程是系统自动完成的，无需人工介入。

## 强制下线与解锁的不同

用户解锁和强制下线最大的差别就是ToughRADIUS不会向NAS（路由器）设备发起请求，仅仅是清除在线纪录，并生成上网日志，它仍然可以解决用户并发限制后挂死的情况。如果一个NAS设备不支持强制下线功能，那么只能通过解锁来实现清理挂死用户。










[image-1]:	../imgs/adv_coa.png
[image-2]:	../imgs/system_param_radius.png
